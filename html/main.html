<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0">
	<title>圣诞礼物</title>
	<link rel="stylesheet" type="text/css" href="..\css\main.css">
</head>
<body>

	<div id='app'></div>
	<div id='box'>
	<div id='recv' class='recv'></div>
    </div>
	<div id="panel" class="panel">
			<header>
				<div class="console">
					<div class="add">
					<div class="score">
						得分：
						<span id="score">0</span>
					</div>
					<div class="drop">
						掉落：
						<span id="drop">0</span>
					</div>
					</div>

					<div class="level">LV1</div>
					<div class="time">
                     30
                    </div>
				</div>
			</header>
			
		</div>
<script src="..\js\fall.js" type="text/javascript"></script>
<script src="..\js\main.js" type="text/javascript"></script>


<script>
	//积分函数
	var s=0;
	var score=document.getElementById("score");
	function add(e)
	{
		s+=e.detail.score;
		score.innerHTML=s;
	}
	//计时器函数
    var t=30;
    var time=document.getElementsByClassName("time")[0];
    function fun()
    {
        t--;
		time.innerHTML=t;
		
        if(t<=0&&s<20||s<0){
			window.location.href="over.html";
			clearInterval(inter);
		}
		else if(t<=0&&s>=20)
		{
			clearInterval(inter);
			clearInterval(id);
			setInterval(()=>{
				gameController.gen(1000,kinds[~~(Math.random()*4)]);
			},800);
			
		}
    }
    var inter=setInterval("fun()",500);

//下落节点记录
	let kinds = [
		{
			score: -500,
			img: '../static/boom.png'
		},
		{
			score: 2,
			img: '../static/gift3.png'
		},
		{
			score: 5,
			img: '../static/gift1.png'
		},
		{
			score: 10,
			img: '../static/gift2.png'
		}
	];
	let backDom = document.getElementById('app');
	window.onload = () => {
		backDom.addEventListener('receive', e => {
			add(e);
		});
	}
	let gameController = new gameLogic();
	gameController.init(backDom, document.getElementById('recv'));
	console.log(gameController.test());
	console.log(gameController);
	let id = setInterval( () => {
		gameController.gen(1500, kinds[~~(Math.random()*4)]);
	},1000);

</script>

</body>
</html>